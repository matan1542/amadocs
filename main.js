const data = {
    "domains": [
        {
            "name": "Care",
            "subDomains": [
                {
                    "name": "account-management-subdomain",
                    "msInstances": [
                        {
                            "name": "account-experience"
                        },
                        {
                            "name": "financialaccount-financialaccount"
                        }
                    ]
                },
                {
                    "name": "customer-bcmconnector-subdomain",
                    "msInstances": [
                        {
                            "name": "customer-bcmconnector"
                        }
                    ]
                },
                {
                    "name": "customer-management-subdomain",
                    "msInstances": [
                        {
                            "name": "customer-customerentity"
                        },
                        {
                            "name": "customer-customersearch"
                        },
                        {
                            "name": "customer-eventprocessor"
                        }
                    ]
                },
                {
                    "name": "geographic-address-subdomain",
                    "msInstances": [
                        {
                            "name": "geographicaddress-geographicaddress"
                        },
                        {
                            "name": "geographicaddress-geographicaddressbridge"
                        },
                        {
                            "name": "geographicaddress-geographicaddressentity"
                        },
                        {
                            "name": "geographicaddress-geographicaddressvalidation"
                        }
                    ]
                },
                {
                    "name": "history-management-subdomain",
                    "msInstances": [
                        {
                            "name": "history-history"
                        }
                    ]
                },
                {
                    "name": "notification-preference-subdomain",
                    "msInstances": [
                        {
                            "name": "notificationpreference-notificationpreference"
                        }
                    ]
                },
                {
                    "name": "party-management-subdomain",
                    "msInstances": [
                        {
                            "name": "party-individual"
                        },
                        {
                            "name": "party-individualsearch"
                        },
                        {
                            "name": "party-relatedparty"
                        }
                    ]
                },
                {
                    "name": "party-interaction-subdomain",
                    "msInstances": [
                        {
                            "name": "partyinteraction-connector"
                        },
                        {
                            "name": "partyinteraction-partyinteraction"
                        }
                    ]
                },
                {
                    "name": "search-management-subdomain",
                    "msInstances": [
                        {
                            "name": "search-search"
                        }
                    ]
                }
            ]
        },
        {
            "name": "OC",
            "subDomains": [
                {
                    "name": "applicationcontext-subdomain",
                    "msInstances": [
                        {
                            "name": "applicationcontext-management"
                        }
                    ]
                },
                {
                    "name": "OCGenealSubDomain",
                    "msInstances": [
                        {
                            "name": "customeraccessor"
                        }
                    ]
                },
                {
                    "name": "pod-subdomain",
                    "msInstances": [
                        {
                            "name": "pod-price"
                        },
                        {
                            "name": "pod-productoffering"
                        },
                        {
                            "name": "pod-search"
                        }
                    ]
                },
                {
                    "name": "pricecalculation-subdomain",
                    "msInstances": [
                        {
                            "name": "price-pricing"
                        },
                        {
                            "name": "price-tax"
                        }
                    ]
                },
                {
                    "name": "productconfigurator-subdomain",
                    "msInstances": [
                        {
                            "name": "productconfigurator-action"
                        },
                        {
                            "name": "productconfigurator-commitmentterm"
                        },
                        {
                            "name": "productconfigurator-price"
                        },
                        {
                            "name": "productconfigurator-qualification"
                        },
                        {
                            "name": "productconfigurator"
                        },
                        {
                            "name": "productvalidator"
                        }
                    ]
                },
                {
                    "name": "promotion-subdomain",
                    "msInstances": [
                        {
                            "name": "promotion-productofferingcriteria"
                        },
                        {
                            "name": "promotion-qualification"
                        }
                    ]
                },
                {
                    "name": "resource-management-subdomain",
                    "msInstances": [
                        {
                            "name": "resource-management"
                        }
                    ]
                },
                {
                    "name": "servicequalification-subdomain",
                    "msInstances": [
                        {
                            "name": "servicequalification-servicequalification"
                        }
                    ]
                },
                {
                    "name": "shoppingcart-subdomain",
                    "msInstances": [
                        {
                            "name": "shoppingcart-price"
                        },
                        {
                            "name": "shoppingcart-shoppingcart"
                        },
                        {
                            "name": "shoppingcart-validate"
                        }
                    ]
                }
            ]
        }
    ],
    "systemDomains": [
        {
            "name": "Care",
            "subDomains": [
                {
                    "name": "account-management-subdomain",
                    "msInstances": [
                        {
                            "name": "account-billingaccount"
                        },
                        {
                            "name": "account-billingaccounteventprocessor"
                        },
                        {
                            "name": "account-billingaccountsearch"
                        },
                        {
                            "name": "account-experience"
                        },
                        {
                            "name": "account-financialaccounteventprocessor"
                        },
                        {
                            "name": "account-financialaccountsearch"
                        },
                        {
                            "name": "accountmanagement-referencedata"
                        },
                        {
                            "name": "financialaccount-financialaccount"
                        }
                    ]
                },
                {
                    "name": "CareGenealSubDomain",
                    "msInstances": [
                        {
                            "name": "account-relatedaccount"
                        },
                        {
                            "name": "attachment-attachment"
                        },
                        {
                            "name": "attachmentmanagement-referencedata"
                        }
                    ]
                },
                {
                    "name": "channel-channel-subdomain",
                    "msInstances": [
                        {
                            "name": "channel-channel"
                        }
                    ]
                },
                {
                    "name": "customer-bcmconnector-subdomain",
                    "msInstances": [
                        {
                            "name": "customer-bcmconnector"
                        }
                    ]
                },
                {
                    "name": "customer-management-subdomain",
                    "msInstances": [
                        {
                            "name": "customer-creditinquiry"
                        },
                        {
                            "name": "customer-creditinquirybridge"
                        },
                        {
                            "name": "customer-creditprofile"
                        },
                        {
                            "name": "customer-customer"
                        },
                        {
                            "name": "customer-customerentity"
                        },
                        {
                            "name": "customer-customersearch"
                        },
                        {
                            "name": "customer-eventprocessor"
                        },
                        {
                            "name": "customer-experience"
                        },
                        {
                            "name": "customermanagement-referencedata"
                        }
                    ]
                },
                {
                    "name": "geographic-address-subdomain",
                    "msInstances": [
                        {
                            "name": "geographicaddress-experience"
                        },
                        {
                            "name": "geographicaddress-geographicaddress"
                        },
                        {
                            "name": "geographicaddress-geographicaddressbridge"
                        },
                        {
                            "name": "geographicaddress-geographicaddressentity"
                        },
                        {
                            "name": "geographicaddress-geographicaddressvalidation"
                        },
                        {
                            "name": "geographicaddressmanagement-referencedata"
                        }
                    ]
                },
                {
                    "name": "geographic-site-subdomain",
                    "msInstances": [
                        {
                            "name": "geographicsite-geographicsite"
                        }
                    ]
                },
                {
                    "name": "history-management-subdomain",
                    "msInstances": [
                        {
                            "name": "history-eventprocessor"
                        },
                        {
                            "name": "history-history"
                        }
                    ]
                },
                {
                    "name": "notification-preference-subdomain",
                    "msInstances": [
                        {
                            "name": "notificationpreference-notificationpreference"
                        },
                        {
                            "name": "notificationpreference-referencedata"
                        }
                    ]
                },
                {
                    "name": "party-management-subdomain",
                    "msInstances": [
                        {
                            "name": "party-experience"
                        },
                        {
                            "name": "party-individual"
                        },
                        {
                            "name": "party-individualeventprocessor"
                        },
                        {
                            "name": "party-individualsearch"
                        },
                        {
                            "name": "party-organization"
                        },
                        {
                            "name": "party-organizationsearch"
                        },
                        {
                            "name": "party-relatedparty"
                        },
                        {
                            "name": "partymanagement-referencedata"
                        }
                    ]
                },
                {
                    "name": "party-interaction-subdomain",
                    "msInstances": [
                        {
                            "name": "partyinteraction-connector"
                        },
                        {
                            "name": "partyinteraction-experience"
                        },
                        {
                            "name": "partyinteraction-interactionsearch"
                        },
                        {
                            "name": "partyinteraction-interactiontask"
                        },
                        {
                            "name": "partyinteraction-partyinteraction"
                        },
                        {
                            "name": "partyinteraction-referencedata"
                        }
                    ]
                },
                {
                    "name": "paymentmethod-subdomain",
                    "msInstances": [
                        {
                            "name": "paymentmethod-paymentmethod"
                        },
                        {
                            "name": "paymentmethod-referencedata"
                        }
                    ]
                },
                {
                    "name": "place-place-subdomain",
                    "msInstances": [
                        {
                            "name": "place-place"
                        }
                    ]
                },
                {
                    "name": "privacy-management-subdomain",
                    "msInstances": [
                        {
                            "name": "privacy-partyprivacyprofile"
                        },
                        {
                            "name": "privacy-partyprivacyprofilespecification"
                        },
                        {
                            "name": "privacy-referencedata"
                        }
                    ]
                },
                {
                    "name": "privacyconfig-subdomain",
                    "msInstances": [
                        {
                            "name": "privacyconfig-referencedata"
                        }
                    ]
                },
                {
                    "name": "search-management-subdomain",
                    "msInstances": [
                        {
                            "name": "search-experience"
                        },
                        {
                            "name": "search-search"
                        }
                    ]
                },
                {
                    "name": "trouble-ticket-subdomain",
                    "msInstances": [
                        {
                            "name": "ticket-activityintegrationproduct"
                        }
                    ]
                }
            ]
        },
        {
            "name": "foundation",
            "subDomains": [
                {
                    "name": "sso",
                    "msInstances": [
                        {
                            "name": "amd-apigw-stack"
                        },
                        {
                            "name": "fndsec-sso-provider-helm-chart"
                        }
                    ]
                },
                {
                    "name": "idm",
                    "msInstances": [
                        {
                            "name": "asm-services-cloud"
                        }
                    ]
                },
                {
                    "name": "couchbase-service-broker",
                    "msInstances": [
                        {
                            "name": "couchbase-service-broker"
                        }
                    ]
                },
                {
                    "name": "ds",
                    "msInstances": [
                        {
                            "name": "fndsec-ds-helm-chart"
                        }
                    ]
                }
            ]
        },
        {
            "name": "OC",
            "subDomains": [
                {
                    "name": "applicationcontext-subdomain",
                    "msInstances": [
                        {
                            "name": "applicationcontext-management"
                        }
                    ]
                },
                {
                    "name": "shoppingcart-subdomain",
                    "msInstances": [
                        {
                            "name": "cartitemaccessor"
                        },
                        {
                            "name": "shoppingcart-checkout"
                        },
                        {
                            "name": "shoppingcart-experience"
                        },
                        {
                            "name": "shoppingcart-modify"
                        },
                        {
                            "name": "shoppingcart-price"
                        },
                        {
                            "name": "shoppingcart-shoppingcart"
                        },
                        {
                            "name": "shoppingcart-validate"
                        }
                    ]
                },
                {
                    "name": "OCGenealSubDomain",
                    "msInstances": [
                        {
                            "name": "customeraccessor"
                        },
                        {
                            "name": "numberportability-npsimulator"
                        },
                        {
                            "name": "paymentmanagement-payment"
                        },
                        {
                            "name": "productaccessor"
                        }
                    ]
                },
                {
                    "name": "numberportability-subdomain",
                    "msInstances": [
                        {
                            "name": "numberportability-portoutorder"
                        }
                    ]
                },
                {
                    "name": "orderitemaccessor-subdomain",
                    "msInstances": [
                        {
                            "name": "orderitemaccessor"
                        }
                    ]
                },
                {
                    "name": "pi-subdomain",
                    "msInstances": [
                        {
                            "name": "pi-archive"
                        },
                        {
                            "name": "pi-experience"
                        },
                        {
                            "name": "pi-factory"
                        },
                        {
                            "name": "pi-price"
                        },
                        {
                            "name": "pi-product"
                        },
                        {
                            "name": "pi-search"
                        }
                    ]
                },
                {
                    "name": "pod-subdomain",
                    "msInstances": [
                        {
                            "name": "pod-category"
                        },
                        {
                            "name": "pod-experience"
                        },
                        {
                            "name": "pod-price"
                        },
                        {
                            "name": "pod-productoffering"
                        },
                        {
                            "name": "pod-search"
                        }
                    ]
                },
                {
                    "name": "pricecalculation-subdomain",
                    "msInstances": [
                        {
                            "name": "price-pricing"
                        },
                        {
                            "name": "price-productoffering"
                        },
                        {
                            "name": "price-tax"
                        },
                        {
                            "name": "scheduler-task"
                        }
                    ]
                },
                {
                    "name": "productorder-subdomain",
                    "msInstances": [
                        {
                            "name": "product-order-experience"
                        },
                        {
                            "name": "productorder-amendorder"
                        },
                        {
                            "name": "productorder-amendorder"
                        },
                        {
                            "name": "productorder-deliverproductorder"
                        },
                        {
                            "name": "productorder-futurelauncher"
                        },
                        {
                            "name": "productorder-limiteddurationproduct"
                        },
                        {
                            "name": "productorder-modifyorder"
                        },
                        {
                            "name": "productorder-paymentorder"
                        },
                        {
                            "name": "productorder-price"
                        },
                        {
                            "name": "productorder-productorder"
                        },
                        {
                            "name": "productorder-productorder"
                        },
                        {
                            "name": "productorder-search"
                        },
                        {
                            "name": "productorder-submitorder"
                        },
                        {
                            "name": "productorder-submitorder"
                        },
                        {
                            "name": "productorder-validateorder"
                        },
                        {
                            "name": "productorder-validateorder"
                        }
                    ]
                },
                {
                    "name": "productconfigurator-subdomain",
                    "msInstances": [
                        {
                            "name": "productconfigurator-action"
                        },
                        {
                            "name": "productconfigurator-commitmentterm"
                        },
                        {
                            "name": "productconfigurator-experience"
                        },
                        {
                            "name": "productconfigurator-mergeentities"
                        },
                        {
                            "name": "productconfigurator-price"
                        },
                        {
                            "name": "productconfigurator-qualification"
                        },
                        {
                            "name": "productconfigurator-replace"
                        },
                        {
                            "name": "productconfigurator"
                        },
                        {
                            "name": "productvalidator"
                        }
                    ]
                },
                {
                    "name": "promotion-subdomain",
                    "msInstances": [
                        {
                            "name": "promotion-customercriteria"
                        },
                        {
                            "name": "promotion-limitedduration"
                        },
                        {
                            "name": "promotion-productofferingcriteria"
                        },
                        {
                            "name": "promotion-qualification"
                        }
                    ]
                },
                {
                    "name": "resource-management-subdomain",
                    "msInstances": [
                        {
                            "name": "resource-management"
                        }
                    ]
                },
                {
                    "name": "resourcemanagement-subdomain",
                    "msInstances": [
                        {
                            "name": "resourcemanagement-experience"
                        }
                    ]
                },
                {
                    "name": "servicequalification-subdomain",
                    "msInstances": [
                        {
                            "name": "servicequalification-servicequalification"
                        }
                    ]
                },
                {
                    "name": "stock-management-subdomain",
                    "msInstances": [
                        {
                            "name": "stock-productstock"
                        },
                        {
                            "name": "stock-productstockbridge"
                        }
                    ]
                }
            ]
        },
        {
            "name": "order-handling",
            "subDomains": [
                {
                    "name": "businessactivity-subdomain",
                    "msInstances": [
                        {
                            "name": "businessactivity-immediatepayment"
                        },
                        {
                            "name": "businessactivity-notifybilling"
                        },
                        {
                            "name": "businessactivity-notifycharging"
                        },
                        {
                            "name": "businessactivity-notifycustomer"
                        },
                        {
                            "name": "businessactivity-numberportabilityfulfillment"
                        },
                        {
                            "name": "businessactivity-prepaybalance"
                        },
                        {
                            "name": "businessactivity-productinventory"
                        },
                        {
                            "name": "businessactivity-productorder"
                        },
                        {
                            "name": "businessactivity-resourcefulfillment"
                        },
                        {
                            "name": "businessactivity-shipping"
                        },
                        {
                            "name": "businessactivity-som"
                        }
                    ]
                },
                {
                    "name": "chargingintegration-subdomain",
                    "msInstances": [
                        {
                            "name": "chargingintegration-notifycharging"
                        }
                    ]
                },
                {
                    "name": "falloutmanagement-subdomain",
                    "msInstances": [
                        {
                            "name": "fallout-integration"
                        }
                    ]
                },
                {
                    "name": "odo-simulator-subdomain",
                    "msInstances": [
                        {
                            "name": "odo-simulator"
                        }
                    ]
                },
                {
                    "name": "order-handlingGenealSubDomain",
                    "msInstances": [
                        {
                            "name": "orderexecution-archive"
                        }
                    ]
                },
                {
                    "name": "orderexecution-subdomain",
                    "msInstances": [
                        {
                            "name": "orderexecution-cataloggateway"
                        },
                        {
                            "name": "orderexecution-flowcontext"
                        },
                        {
                            "name": "orderexecution-handleorder"
                        },
                        {
                            "name": "orderexecution-orderresolver"
                        },
                        {
                            "name": "orderhistorytracking-orderhistorytracking"
                        }
                    ]
                },
                {
                    "name": "orderworkflow-subdomain",
                    "msInstances": [
                        {
                            "name": "orderworkflow-aggregationmanager"
                        },
                        {
                            "name": "orderworkflow-liteorchestrator"
                        },
                        {
                            "name": "orderworkflow-orchestrator"
                        },
                        {
                            "name": "orderworkflow-recoverymanager"
                        },
                        {
                            "name": "orderworkflowmanagement-workflowmanager"
                        }
                    ]
                },
                {
                    "name": "selfhealing-subdomain",
                    "msInstances": [
                        {
                            "name": "selfhealing-selfhealing"
                        }
                    ]
                },
                {
                    "name": "shippingorder-subdomain",
                    "msInstances": [
                        {
                            "name": "shippingorder-management"
                        }
                    ]
                }
            ]
        },
        {
            "name": "catalog",
            "subDomains": [
                {
                    "name": "runtime-subdomain",
                    "msInstances": [
                        {
                            "name": "c1-dashboard-service"
                        },
                        {
                            "name": "dispatcher-service"
                        },
                        {
                            "name": "product-offering-service"
                        },
                        {
                            "name": "promotion-mapper-service"
                        },
                        {
                            "name": "rt-generic-element"
                        },
                        {
                            "name": "rt-price-details"
                        }
                    ]
                }
            ]
        },
        {
            "name": "Case",
            "subDomains": [
                {
                    "name": "metrics-subdomain",
                    "msInstances": [
                        {
                            "name": "metrics-metricscollector"
                        }
                    ]
                },
                {
                    "name": "slamanagement-subdomain",
                    "msInstances": [
                        {
                            "name": "slamanagement-poller"
                        },
                        {
                            "name": "slamanagement-slamanagement"
                        },
                        {
                            "name": "slamanagement-template"
                        },
                        {
                            "name": "slamanagement-templatesearch"
                        },
                        {
                            "name": "slamanagement-violation"
                        }
                    ]
                },
                {
                    "name": "trouble-ticket-subdomain",
                    "msInstances": [
                        {
                            "name": "ticket-actionengine"
                        },
                        {
                            "name": "ticket-activityintegrationcustomer"
                        },
                        {
                            "name": "ticket-activityintegrationsla"
                        },
                        {
                            "name": "ticket-activityintegrationticket"
                        },
                        {
                            "name": "ticket-activityintegrationworkitem"
                        },
                        {
                            "name": "ticket-activityintegrationworkresource"
                        },
                        {
                            "name": "ticket-activitylog"
                        },
                        {
                            "name": "ticket-businesseventpublisher"
                        },
                        {
                            "name": "ticket-decision"
                        },
                        {
                            "name": "ticket-externalactivityintegration"
                        },
                        {
                            "name": "ticket-flowcontext"
                        },
                        {
                            "name": "ticket-metricspublisher"
                        },
                        {
                            "name": "ticket-slaeventpublisher"
                        },
                        {
                            "name": "ticket-specification"
                        },
                        {
                            "name": "ticket-specificationsearch"
                        },
                        {
                            "name": "ticket-ticketentity"
                        },
                        {
                            "name": "ticket-ticketsearch"
                        },
                        {
                            "name": "ticket-validate"
                        },
                        {
                            "name": "ticket-workfloworchestrator"
                        },
                        {
                            "name": "ticket-workitemconnector"
                        }
                    ]
                },
                {
                    "name": "workforce-subdomain",
                    "msInstances": [
                        {
                            "name": "workforce-businesscalendar"
                        },
                        {
                            "name": "workforce-businesscalendarsearch"
                        },
                        {
                            "name": "workforce-workforceindividual"
                        },
                        {
                            "name": "workforce-workgroup"
                        },
                        {
                            "name": "workforce-workgroupsearch"
                        }
                    ]
                },
                {
                    "name": "workitem-subdomain",
                    "msInstances": [
                        {
                            "name": "workitem-metricspublisher"
                        },
                        {
                            "name": "workitem-workitementity"
                        },
                        {
                            "name": "workitem-workitemsearch"
                        }
                    ]
                }
            ]
        }
    ]
}
renderChart()
function renderChart() {
    const filterDataArr = findDiffData();
    am4core.ready(function () {

        // Themes begin
        am4core.useTheme(am4themes_animated);
        // Themes end

        var chart = am4core.create("chartdiv", am4plugins_forceDirected.ForceDirectedTree);

        var networkSeries = chart.series.push(new am4plugins_forceDirected.ForceDirectedSeries())
        networkSeries.dataFields.name = "name";
        networkSeries.dataFields.id = "name";
        networkSeries.dataFields.value = "value";
        networkSeries.dataFields.children = "children";

        networkSeries.nodes.template.label.text = "{name}"
        networkSeries.fontSize = 8;
        networkSeries.linkWithStrength = 0;

        var nodeTemplate = networkSeries.nodes.template;
        nodeTemplate.tooltipText = "{name}";
        nodeTemplate.fillOpacity = 1;
        nodeTemplate.label.hideOversized = true;
        nodeTemplate.label.truncate = true;

        var linkTemplate = networkSeries.links.template;
        linkTemplate.strokeWidth = 1;
        var linkHoverState = linkTemplate.states.create("hover");
        linkHoverState.properties.strokeOpacity = 1;
        linkHoverState.properties.strokeWidth = 2;

        nodeTemplate.events.on("over", function (event) {
            var dataItem = event.target.dataItem;
            dataItem.childLinks.each(function (link) {
                link.isHover = true;
            })
        })

        nodeTemplate.events.on("out", function (event) {
            var dataItem = event.target.dataItem;
            dataItem.childLinks.each(function (link) {
                link.isHover = false;
            })
        })
        networkSeries.data = filterDataArr
    })
    console.log('filterDataArr', filterDataArr, findDiffData())
}

function findDiffData() {
    const domainsInsArray = iterateThroughData(data, 'domains')
    const objInstances = mapData(domainsInsArray)
    const filterDataArr = filterData(data.systemDomains, objInstances)
    return filterDataArr
}

function filterData(jsonSystemDomains, objInstances) {
    const res = jsonSystemDomains.map((micro, idx) => {
        const children = {
            name: micro.name,
            value: 1,
            children: micro.subDomains
        }
        delete micro.subDomains
        children.children.forEach((subDom,idx) => {
            const subDomIdx = idx;
            const subDomCopy = subDom.msInstances
            delete subDom.msInstances
            children.children[subDomIdx] = { ...subDom, value: 1, children: [...subDomCopy] }
            children.children[subDomIdx].children.forEach((instance, idx) => {
                if (!objInstances[instance.name.toLowerCase()]) {
                    children.children[subDomIdx].children[idx] = { ...instance, value: 1 }
                }
            })
        })
        return children
    })
    console.log(res)
    return res
}
//function will create an object with name property of the instance for 0(1) usage
function mapData(instances) {
    const diffData = {}
    instances.forEach((instance, idx) => {
        diffData[instance.name.toLowerCase()] = idx
    })
    return diffData
}



function iterateThroughData(json, type, searchType) {
    const microServices = []
    json[type].forEach((micro, idx) => {
        micro.subDomains.forEach((subDom, idx) => {
            subDom.msInstances.forEach((instance, idx) => {
                microServices.push(instance)
            })
        })
    })
    return microServices
}
